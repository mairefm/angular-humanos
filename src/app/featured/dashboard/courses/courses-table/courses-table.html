@if (isLoading$ | async) {

<div class="loading-wrapper">
  <mat-spinner></mat-spinner>
</div>

} @else {

<section class="courses-toolbar">

  <h1 class="page-title">Cursos Disponibles</h1>

  <div class="top-bar-create">
    <button class="btn-create" mat-flat-button color="primary" routerLink="create">
      Crear Curso
    </button>
  </div>

  <div class="filters-row">

    <div class="chips-row">
      <mat-chip-listbox class="status-chips">

        <!-- Todos -->
        <mat-chip-option [selected]="selectedStatus === ''" (click)="onStatusFilterChange('')">
          Todos
        </mat-chip-option>

        <!-- SCHEDULED -->
        <mat-chip-option [selected]="selectedStatus === 'SCHEDULED'" (click)="onStatusFilterChange('SCHEDULED')">
          Scheduled
        </mat-chip-option>

        <!-- STARTED -->
        <mat-chip-option [selected]="selectedStatus === 'STARTED'" (click)="onStatusFilterChange('STARTED')">
          Started
        </mat-chip-option>

        <!-- FINISHED -->
        <mat-chip-option [selected]="selectedStatus === 'FINISHED'" (click)="onStatusFilterChange('FINISHED')">
          Finished
        </mat-chip-option>

      </mat-chip-listbox>
    </div>

    <mat-form-field class="search-field">
      <mat-icon matPrefix>search</mat-icon>
      <input matInput placeholder="Buscar por título o descripción..." (keyup)="applyFilter($event)" #input />
    </mat-form-field>

  </div>

</section>


<div class="mat-elevation-z8 courses-table-wrapper">
  <table mat-table [dataSource]="dataSource">

    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef>ID</th>
      <td mat-cell *matCellDef="let row">{{ row.id }}</td>
    </ng-container>

    <ng-container matColumnDef="title">
      <th mat-header-cell *matHeaderCellDef>Title</th>
      <td mat-cell *matCellDef="let row">
        <div class="course-title-cell">
          <span>{{ row.title }}</span>

          <span *ngIf="isFutureCourse(row.beginDate)" class="badge badge-new">
            Próximo
          </span>
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="description">
      <th mat-header-cell *matHeaderCellDef>Description</th>
      <td mat-cell *matCellDef="let row">
        <span class="description-text">
          {{ row.description | slice:0:140 }}...
        </span>
      </td>
    </ng-container>

    <ng-container matColumnDef="beginDate">
      <th mat-header-cell *matHeaderCellDef>Begin Date</th>
      <td mat-cell *matCellDef="let row">
        {{ row.beginDate | date:'MMM d, y' }}
      </td>
    </ng-container>

    <ng-container matColumnDef="endDate">
      <th mat-header-cell *matHeaderCellDef>End Date</th>
      <td mat-cell *matCellDef="let row">
        {{ row.endDate | date:'MMM d, y' }}
      </td>
    </ng-container>

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Status</th>
      <td mat-cell *matCellDef="let row">
        {{ row.status }}
      </td>
    </ng-container>


    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let row" class="actions-cell">
        <button mat-icon-button matTooltip="Editar curso" routerLink="edit/{{ row.id }}">
          <mat-icon>edit</mat-icon>
        </button>

        <button mat-icon-button matTooltip="Inscribir alumnas" (click)="onEnrollStudents(row)">
          <mat-icon>person_add</mat-icon>
        </button>

        <button mat-icon-button matTooltip="Eliminar" (click)="onDeleteCourse(row.id)">
          <mat-icon>delete</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell" colspan="7">
        No data matching the filters.
      </td>
    </tr>
  </table>

  <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Select page of users"></mat-paginator>
</div>
}